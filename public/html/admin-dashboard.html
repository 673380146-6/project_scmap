<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Science Map</title>
<style>
:root{
  --bg:#f6f8fb;
  --panel:#ffffff;
  --panel-2:#f1f4f9;
  --panel-3:#e8edf5;
  --text:#2b2b2b;
  --muted:#6f7c91;
  --accent:#1f8fff;
  --hover:#dbe9ff;
  --item-hover:#e5f1ff;
  --radius:14px;
  --side-collapsed:80px;
  --side-expanded:260px;
  --gap:12px;
  --shadow:0 4px 20px rgba(0,0,0,.08);
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial, "Noto Sans Thai", "Prompt", sans-serif;
  color:var(--text);
  background: var(--bg);
  overflow:hidden;
}

.container{
  height:100vh;
  width:100vw;
  display:flex;
  gap:0;
}

/* Sidebar */
.sidebar{
  width:var(--side-collapsed);
  background: var(--panel);
  border-right:1px solid #ddd;
  transition: width .25s ease;
  padding:14px 10px;
  position:relative;
  overflow:hidden;
  box-shadow: var(--shadow);
}
.sidebar:hover{ width:var(--side-expanded); }

/* Brand */
.brand{
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px 10px;
  margin-bottom:10px;
  user-select:none;
  white-space:nowrap;
}
.brand .logo{
  width:40px; height:40px; border-radius:8px;
  display:grid; place-items:center;
  background:linear-gradient(145deg,#1a57ff,#00b7ff);
  color:#fff; font-weight:900; font-size:20px;
  box-shadow: inset 0 0 12px #ffffff33;
}
.brand .label{ display:none; font-weight:700; color:var(--text); }
.sidebar:hover .brand .label{ display:inline; }

/* Search */
.search-box{
  display:flex; align-items:center; gap:10px;
  background: var(--panel-3);
  border:1px solid #ccc;
  padding:8px 10px;
  border-radius:999px;
  margin:6px 8px 18px;
}
.search-box .icon{ font-size:18px; color:var(--muted); }
.search-box input{
  border:none; outline:none; background:transparent; color:var(--text);
  width:0; padding:0; opacity:0; transition: all .2s ease;
  font-size:14px;
}
.sidebar:hover .search-box input{ width:100%; opacity:1; }

/* Menu */
.menu-list{
  list-style:none;
  margin:0; padding:0 6px;
}
.menu-item{
  display:flex; align-items:center;
  gap:12px;
  color:var(--muted);
  padding:12px 12px;
  margin:8px 0;
  border-radius: 0 22px 22px 0;
  cursor:pointer;
  position:relative;
  white-space:nowrap;
  font-size:16px;
}
.menu-item .icon{
  width:34px; height:34px; display:grid; place-items:center;
  background:#f0f4f9; border:1px solid #ccc; border-radius:9px;
  font-size:20px;
}
.menu-item .label{ display:none; }
.sidebar:hover .menu-item .label{ display:inline; }

.menu-item:hover{
  background: var(--item-hover);
  color:#000;
}
.menu-item:hover .icon{ border-color:#1f8fff; }

/* Submenu */
.submenu{
  display:none;
  flex-direction:column;
  gap:6px;
  margin-left:46px;
  margin-top:6px;
  margin-bottom:4px;
}
.submenu .sub-item{
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  background:transparent;
  transition: background .2s ease;
}
.submenu .sub-item:hover{
  background:#dbe9ff;
}
.sidebar:hover .submenu.open{ display:flex; }

/* Main */
.main{
  flex:1; min-width:0;
  padding:20px;
  display:flex; flex-direction:column;
  overflow:hidden;
}
.top-bar{
  display:flex; justify-content:space-between; align-items:center;
  padding-bottom:18px;
}
.title{
  font-weight:800; font-size:20px; color:var(--text);
}

/* Settings */
.settings{ position:relative; cursor:pointer; }
.settings svg{ width:26px; height:26px; fill:var(--text); }
.settings-menu{
  display:none; position:absolute; top:120%; right:0;
  background:#fff; border:1px solid #ddd; border-radius:12px;
  box-shadow: var(--shadow); min-width:220px; z-index:10; overflow:hidden;
}
.settings.active .settings-menu{ display:block; }
.settings-menu .profile-info{
  padding:12px; text-align:center; border-bottom:1px solid #ddd;
}
.settings-menu .profile-info .name{ font-weight:700; font-size:16px; color:#000; }
.settings-menu .profile-info .faculty-major{ color:#555; font-size:13px; }
.settings-menu .logout{
  display:block; text-align:center; padding:10px;
  background:#1f8fff; color:#fff; text-decoration:none; font-weight:700;
}
.settings-menu .logout:hover{ background:#0f6fde; }

/* Canvas */
.canvas-area{
  flex:1; border-radius:12px; border:1px dashed #ccc;
  display:flex; align-items:center; justify-content:center; color:#666;
  overflow:hidden; background: #fff;
}

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}
</style>
</head>
<body>

<div class="container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">S</div>
      <div class="label">SCIENCE MAP</div>
    </div>

    <div class="search-box">
      <div class="icon">üîé</div>
      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterList()">
    </div>

    <ul class="menu-list" id="menuList">
      <li class="menu-item has-sub" data-name="‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏ì‡∏∞" onclick="toggleSubmenu('building-submenu', event)">
        <span class="icon">üèõ</span>
        <span class="label">‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏ì‡∏∞</span>
      </li>
      <div class="submenu" id="building-submenu">
        <div class="sub-item" onclick="showCanvas('SC01')">SC01</div>
        <div class="sub-item" onclick="showCanvas('SC02')">SC02</div>
        <div class="sub-item" onclick="showCanvas('SC03')">SC03</div>
      </div>
      <li class="menu-item" data-name="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£" onclick="showCanvas('‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£')">
        <span class="icon">üçú</span>
        <span class="label">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </li>
      <li class="menu-item" data-name="‡∏ï‡∏π‡πâ & ‡πÄ‡∏ï‡πà‡∏≤‡∏ö‡∏¥‡∏ô" onclick="showCanvas('‡∏ï‡∏π‡πâ & ‡πÄ‡∏ï‡πà‡∏≤‡∏ö‡∏¥‡∏ô')">
        <span class="icon">‚öôÔ∏è</span>
        <span class="label">‡∏ï‡∏π‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ & ‡πÄ‡∏ï‡πà‡∏≤‡∏ö‡∏¥‡∏ô</span>
      </li>
      <li class="menu-item" data-name="‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå" onclick="showCanvas('‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå')">
        <span class="icon">üöó</span>
        <span class="label">‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</span>
      </li>
      <li class="menu-item" data-name="‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏°‡∏≠‡πÑ‡∏ã‡∏Ñ‡πå" onclick="showCanvas('‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏°‡∏≠‡πÑ‡∏ã‡∏Ñ‡πå')">
        <span class="icon">üõµ</span>
        <span class="label">‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏°‡∏≠‡πÑ‡∏ã‡∏Ñ‡πå</span>
      </li>
      <li class="menu-item" data-name="‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" onclick="showAdminsTable()">
        <span class="icon">üõ†Ô∏è</span>
        <span class="label">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
      </li>
      <li class="menu-item" data-name="‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£" onclick="showUsersTable()">
        <span class="icon">üìã</span>
        <span class="label">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span>
      </li>
    </ul>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="top-bar">
      <div class="title" id="userDisplayName">SCIENCE MAP</div>
      <div class="settings" onclick="toggleSettingsMenu(this)">
        <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-3.5c0-.36-.03-.72-.08-1.07l2.11-1.65a.5.5 0 0 0 .12-.65l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1a7.16 7.16 0 0 0-1.84-1.07L14.5 2.5a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 0-.5.5l-.24 2.88a7.16 7.16 0 0 0-1.84 1.07l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.5.5 0 0 0 .12.65l2.11 1.65c-.05.35-.08.71-.08 1.07s.03.72.08 1.07l-2.11 1.65a.5.5 0 0 0-.12.65l2 3.46a.5.5 0 0 0 .61.22l2.49-1a7.16 7.16 0 0 0 1.84 1.07L9.5 21.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5l.24-2.88a7.16 7.16 0 0 0 1.84-1.07l2.49 1a.5.5 0 0 0 .61-.22l2-3.46a.5.5 0 0 0-.12-.65l-2.11-1.65c.05-.35.08-.71.08-1.07z"/></svg>
        <div class="settings-menu">
          <div class="profile-info">
            <div class="name" id="userName">‡πÄ‡πÄ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
            <div class="faculty-major" id="userFacultyMajor">‡πÄ‡πÄ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
          </div>
          <a href="index.html" class="logout" onclick="logoutUser(event)">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
      </div>
    </div>

    <div class="canvas-area" id="canvas">
      <model-viewer
        src="../models/cp09model.glb"
        alt="3D model"
        auto-rotate
        camera-controls
        style="width: 100%; height: 100%;"
      ></model-viewer>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Admin -->
    <div id="adminsTable" style="display:none;">
      <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (Admins)</h3>
      <button onclick="addAdmin()" style="margin-bottom:10px; background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 6px;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
      <table>
        <thead>
          <tr>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
          </tr>
        </thead>
        <tbody id="adminsList"></tbody>
      </table>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Users -->
    <div id="usersTable" style="display:none;">
      <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (Users)</h3>
      <button onclick="addUser()" style="margin-bottom:10px; background: var(--accent); color: white; border: none; padding: 8px 12px; border-radius: 6px;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
      <table>
        <thead>
          <tr>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
          </tr>
        </thead>
        <tbody id="usersList"></tbody>
      </table>
    </div>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAmfunEqGUmZHabiPKYwCuay3JCRVXa_DU",
  authDomain: "project-web-f9a73.firebaseapp.com",
  projectId: "project-web-f9a73",
  storageBucket: "project-web-f9a73.appspot.com",
  messagingSenderId: "809705005062",
  appId: "1:809705005062:web:f4736c194fc7cf68c5e387",
  measurementId: "G-BK760T9XCW"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Admin
window.showAdminsTable = async function () {
  document.getElementById("canvas").style.display = "none";
  document.getElementById("usersTable").style.display = "none";
  document.getElementById("adminsTable").style.display = "block";
  const tbody = document.getElementById("adminsList");
  tbody.innerHTML = "";
  try {
    const querySnapshot = await getDocs(collection(db, "admin")); // collection: admin (‡πÄ‡∏≠‡∏Å‡∏û‡∏à‡∏ô‡πå)
    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      tbody.innerHTML += `
        <tr>
          <td contenteditable="true" onblur="updateAdmin('${docSnap.id}', 'user', this.innerText)">${data.user || "-"}</td>
        </tr>
      `;
    });
  } catch (e) {
    alert("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};
window.updateAdmin = async function (id, field, value) {
  try {
    const ref = doc(db, "admin", id);
    await updateDoc(ref, { [field]: value });
  } catch (e) {
    alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};
window.addAdmin = async function () {
  try {
    await addDoc(collection(db, "admin"), { user: "‡πÉ‡∏´‡∏°‡πà" });
    showAdminsTable();
  } catch (e) {
    alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};

// Users
window.showUsersTable = async function () {
  document.getElementById("canvas").style.display = "none";
  document.getElementById("adminsTable").style.display = "none";
  document.getElementById("usersTable").style.display = "block";
  const tbody = document.getElementById("usersList");
  tbody.innerHTML = "";
  try {
    const querySnapshot = await getDocs(collection(db, "users"));
    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      tbody.innerHTML += `
        <tr>
          <td contenteditable="true" onblur="updateUser('${docSnap.id}', 'user', this.innerText)">${data.user || "-"}</td>
        </tr>
      `;
    });
  } catch (e) {
    alert("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};
window.updateUser = async function (id, field, value) {
  try {
    const ref = doc(db, "users", id);
    await updateDoc(ref, { [field]: value });
  } catch (e) {
    alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};
window.addUser = async function () {
  try {
    await addDoc(collection(db, "users"), { user: "‡πÉ‡∏´‡∏°‡πà" });
    showUsersTable();
  } catch (e) {
    alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + e.message);
  }
};
</script>

<script>
function filterList() {
  const input = document.getElementById('searchInput').value.toLowerCase();
  const items = document.querySelectorAll('#menuList li.menu-item');
  items.forEach(item => {
    const text = item.dataset.name.toLowerCase();
    item.style.display = text.includes(input) ? 'flex' : 'none';
  });
}
function toggleSubmenu(id, e) {
  e.stopPropagation();
  document.getElementById(id).classList.toggle('open');
}
function showCanvas(name) {
  document.getElementById('usersTable').style.display = 'none';
  document.getElementById('adminsTable').style.display = 'none';
  const canvas = document.getElementById('canvas');
  canvas.style.display = 'flex';
  canvas.innerHTML = `<div><strong>${name}</strong></div>`;
}
function toggleSettingsMenu(elem) { elem.classList.toggle('active'); }
function logoutUser(event) {
  event.preventDefault();
  localStorage.clear();
  window.location.href = "index.html";
}
window.addEventListener("DOMContentLoaded", () => {
  const fullName = localStorage.getItem("fullName");
  const faculty  = localStorage.getItem("faculty");
  const major    = localStorage.getItem("major");

  if (fullName) {
    document.getElementById("userName").textContent = fullName;
    document.getElementById("userDisplayName").textContent = fullName;
  }
  if (faculty || major) {
    const sep = faculty && major ? " | " : "";
    document.getElementById("userFacultyMajor").textContent = `${faculty || ""}${sep}${major || ""}`;
  }
});
// ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π Settings ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á
window.addEventListener("click", (e) => {
  const settings = document.querySelector(".settings");
  if (settings && !settings.contains(e.target)) settings.classList.remove("active");
});
</script>

<!-- model-viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</body>
</html>
